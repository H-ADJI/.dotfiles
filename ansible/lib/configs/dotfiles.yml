- name: Stowing dotfiles
  hosts: localhost
  become: true
  become_user: "{{ user }}"
  vars:
    git_repo_url: https://github.com/H-ADJI/.dotfiles
    git_repo_dir: "{{ home_dir }}/.dotfiles"
  tasks:
    - name: Clone the dotfiles repository
      ansible.builtin.git:
        repo: "{{ git_repo_url }}"
        dest: "{{ git_repo_dir }}"
        clone: yes

    - name: Apply GNU Stow to all subdirectories in the dotfiles repo
      ansible.builtin.shell: |
        for dir in {{ git_repo_dir }}/*; do
          if [ -d "$dir" ]; then
            stow -d {{ git_repo_dir }} -t {{ home_dir }} "$(basename "$dir")"
          fi
        done
      args:
        executable: /bin/bash
